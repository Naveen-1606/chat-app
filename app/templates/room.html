{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8">
    <h1 class="text-2xl font-bold mb-4">{{ room.name }}</h1>

    <!-- Message list -->
    <div id="message-list" class="border rounded-lg p-4 h-96 overflow-y-auto bg-white shadow">
        {% include "partials/message_list.html" %}
    </div>

    <!-- Message form -->
    <form
        hx-post="/chat/rooms/{{ room.id }}/messages"
        hx-target="#message-list"
        hx-swap="innerHTML"
        class="mt-4 flex"
    >
        <input 
            type="text" 
            name="content" 
            placeholder="Type a message..." 
            class="flex-1 border rounded-l-lg p-2 focus:outline-none"
            required
        >
        <button 
            type="submit" 
            class="bg-blue-500 hover:bg-blue-600 text-white rounded-r-lg px-4"
        >
            Send
        </button>
    </form>
</div>

<script>
    // WebSocket connection
    const ws = new WebSocket(`ws://${window.location.host}/ws/chat/{{ room.id }}`);

    ws.onmessage = function(event) {
        // Replace the message list content with new HTML from server
        document.getElementById("message-list").innerHTML = event.data;
    };

    ws.onclose = function() {
        console.log("WebSocket connection closed");
    };
</script>
{% endblock %}
